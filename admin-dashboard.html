<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - JDM Credit & Finance</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #0a3d62; color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
    .logo-section { display: flex; align-items: center; }
    .logo-section img { height: 40px; margin-right: 10px; }
    .stats { display: flex; gap: 20px; padding: 20px; flex-wrap: wrap; }
    .stat-box { flex: 1; min-width: 200px; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; }
    .section { margin: 20px; background: white; padding: 20px; border-radius: 10px; }
    button { padding: 10px 15px; border: none; background: #0a3d62; color: white; border-radius: 5px; cursor: pointer; margin-right: 10px; }
    input, select { padding: 8px; margin-right: 10px; border-radius: 5px; border: 1px solid #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background-color: #0a3d62; color: white; }
    .logout-btn { background: red; }
  </style>
</head>
<body>

<header>
  <div class="logo-section">
    <img src="https://i.ibb.co/5TpqK1H/banklogo.png" alt="Logo">
    <h2>JDM CREDIT & FINANCE - Admin Dashboard</h2>
  </div>
  <button onclick="logout()" class="logout-btn">Logout</button>
</header>

<div class="stats">
  <div class="stat-box"><h3>Total FDs</h3><p id="fdCount">0</p></div>
  <div class="stat-box"><h3>Total FD Principal (₹)</h3><p id="fdPrincipal">0</p></div>
  <div class="stat-box"><h3>Total RDs</h3><p id="rdCount">0</p></div>
  <div class="stat-box"><h3>Total RD Principal (₹)</h3><p id="rdPrincipal">0</p></div>
</div>

<div class="section">
  <h3>Daily Report</h3>
  <button onclick="loadDailyReport()">Show Today's FD & RD</button>
  <div id="dailyReport"></div>
</div>

<div class="section">
  <h3>Customer Search</h3>
  <input type="text" id="searchInput" placeholder="Enter Name or Mobile">
  <button onclick="searchCustomer()">Search</button>
  <div id="customerResult"></div>
</div>

<div class="section">
  <h3>Approved Entries Filter</h3>
  <label>From: <input type="date" id="fromDate"></label>
  <label>To: <input type="date" id="toDate"></label>
  <button onclick="filterApproved()">Show Approved FDs & RDs</button>
  <div id="approvedResult"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDLvrY6y3SyvLrX-yk8UcdO8RmnC89XNG4",
    authDomain: "jdms-207ba.firebaseapp.com",
    projectId: "jdms-207ba",
    storageBucket: "jdms-207ba.appspot.com",
    messagingSenderId: "449814553435",
    appId: "1:449814553435:web:008c7695473689f425307e"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  function logout() {
    auth.signOut().then(() => {
      localStorage.clear();
      window.location.href = "index.html";
    });
  }

  function loadStats() {
    db.collection("fd").where("status", "==", "approved").get().then(snapshot => {
      let count = 0, total = 0;
      snapshot.forEach(doc => {
        count++;
        total += parseFloat(doc.data().principal) || 0;
      });
      document.getElementById("fdCount").innerText = count;
      document.getElementById("fdPrincipal").innerText = total.toLocaleString();
    });

    db.collection("rd").where("status", "==", "approved").get().then(snapshot => {
      let count = 0, total = 0;
      snapshot.forEach(doc => {
        count++;
        total += parseFloat(doc.data().principal) || 0;
      });
      document.getElementById("rdCount").innerText = count;
      document.getElementById("rdPrincipal").innerText = total.toLocaleString();
    });
  }

  function loadDailyReport() {
    const today = new Date().toISOString().split('T')[0];
    const container = document.getElementById("dailyReport");
    container.innerHTML = "<h4>FDs Created Today</h4>";
    db.collection("fd").where("startDate", "==", today).get().then(snapshot => {
      snapshot.forEach(doc => {
        const d = doc.data();
        container.innerHTML += `<p>${d.name} - ₹${d.principal} - FD</p>`;
      });
    });

    container.innerHTML += "<h4>RDs Created Today</h4>";
    db.collection("rd").where("startDate", "==", today).get().then(snapshot => {
      snapshot.forEach(doc => {
        const d = doc.data();
        container.innerHTML += `<p>${d.name} - ₹${d.principal} - RD</p>`;
      });
    });
  }

  function searchCustomer() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const container = document.getElementById("customerResult");
    container.innerHTML = "<h4>FDs</h4>";
    db.collection("fd").where("status", "==", "approved").get().then(snapshot => {
      snapshot.forEach(doc => {
        const d = doc.data();
        if ((d.name && d.name.toLowerCase().includes(query)) || (d.mobile && d.mobile.includes(query))) {
          container.innerHTML += `<p>${d.name} - ₹${d.principal} FD - ${d.startDate}</p>`;
        }
      });
    });

    container.innerHTML += "<h4>RDs</h4>";
    db.collection("rd").where("status", "==", "approved").get().then(snapshot => {
      snapshot.forEach(doc => {
        const d = doc.data();
        if ((d.name && d.name.toLowerCase().includes(query)) || (d.mobile && d.mobile.includes(query))) {
          container.innerHTML += `<p>${d.name} - ₹${d.principal} RD - ${d.startDate}</p>`;
        }
      });
    });
  }

  function filterApproved() {
    const from = document.getElementById("fromDate").value;
    const to = document.getElementById("toDate").value;
    const container = document.getElementById("approvedResult");
    if (!from || !to) return alert("Please select both dates");

    container.innerHTML = "<h4>Approved FDs</h4>";
    db.collection("fd").where("status", "==", "approved").get().then(snapshot => {
      snapshot.forEach(doc => {
        const d = doc.data();
        if (d.startDate >= from && d.startDate <= to) {
          container.innerHTML += `<p>${d.name} - ₹${d.principal} FD - ${d.startDate}</p>`;
        }
      });
    });

    container.innerHTML += "<h4>Approved RDs</h4>";
    db.collection("rd").where("status", "==", "approved").get().then(snapshot => {
      snapshot.forEach(doc => {
        const d = doc.data();
        if (d.startDate >= from && d.startDate <= to) {
          container.innerHTML += `<p>${d.name} - ₹${d.principal} RD - ${d.startDate}</p>`;
        }
      });
    });
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      loadStats();
    } else {
      alert("Session expired. Please login again.");
      window.location.href = "index.html";
    }
  });
</script>

</body>
</html>
