<!-- ‚úÖ PDF Generator Page with Back Button and Individual Certificate Downloads -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Print Certificates - JDM Credit & Finance</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 20px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
    }
    header h2 {
      color: #0a3d62;
    }
    .back-btn {
      background-color: #c0392b;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .entry-list {
      margin-top: 30px;
    }
    .entry-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .entry-card h3 {
      margin-top: 0;
    }
    .download-btn {
      background-color: #0a3d62;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <h2>üìÑ Approved Certificates - JDM Credit & Finance</h2>
  <button class="back-btn" onclick="location.href='customer-dashboard.html'">‚¨ÖÔ∏è Back to Dashboard</button>
</header>

<div class="entry-list" id="entryList">Loading certificates...</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDLvrY6y3SyvLrX-yk8UcdO8RmnC89XNG4",
    authDomain: "jdms-207ba.firebaseapp.com",
    projectId: "jdms-207ba",
    storageBucket: "jdms-207ba.appspot.com",
    messagingSenderId: "449814553435",
    appId: "1:449814553435:web:008c7695473689f425307e"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const customerId = localStorage.getItem("customerId");
  const customerName = localStorage.getItem("customerName");
  const entryList = document.getElementById("entryList");

  async function loadApprovedCertificates() {
    let approvedFDs = await db.collection("fd").where("customerId", "==", customerId).where("status", "==", "approved").get();
    let approvedRDs = await db.collection("rd").where("customerId", "==", customerId).where("status", "==", "approved").get();
    let html = "";

    approvedFDs.forEach(doc => {
      const d = doc.data();
      html += createCard("FD", d);
    });

    approvedRDs.forEach(doc => {
      const d = doc.data();
      html += createCard("RD", d);
    });

    entryList.innerHTML = html || '<p>No approved entries found.</p>';
  }

  function createCard(type, data) {
    const id = Math.random().toString(36).substring(2, 10);
    return `
      <div class="entry-card">
        <h3>${type} - ‚Çπ${data.principal} to ‚Çπ${data.maturityAmount}</h3>
        <p><strong>Start:</strong> ${data.startDate || '-'} | <strong>Years:</strong> ${data.duration} | <strong>Rate:</strong> ${data.interestRate}%</p>
        <button class="download-btn" onclick="generatePDF('${type}', '${data.principal}', '${data.maturityAmount}', '${data.duration}', '${data.interestRate}', '${data.startDate || ''}', '${id}')">Download PDF</button>
      </div>
    `;
  }

  async function generatePDF(type, principal, maturity, duration, rate, start, id) {
    const {{ jsPDF }} = window.jspdf;
    const doc = new jsPDF();

    // Logo
    const img = new Image();
    img.src = 'JDM LOGO.png';
    await new Promise(resolve => img.onload = resolve);
    doc.addImage(img, 'PNG', 15, 10, 20, 20);

    doc.setFontSize(16);
    doc.text("JDM CREDIT & FINANCE", 40, 20);
    doc.setFontSize(12);
    doc.text(`Certificate of Investment (${type})`, 15, 40);

    doc.text(`Customer Name: ${customerName}`, 15, 50);
    doc.text(`Principal Amount: ‚Çπ${principal}`, 15, 60);
    doc.text(`Maturity Amount: ‚Çπ${maturity}`, 15, 70);
    doc.text(`Duration: ${duration} Year(s)`, 15, 80);
    doc.text(`Interest Rate: ${rate}%`, 15, 90);
    doc.text(`Start Date: ${start}`, 15, 100);

    // Footer
    doc.line(15, 150, 195, 150);
    doc.text("Director: Bhawana Sharma", 15, 160);
    const stamp = new Image();
    stamp.src = 'https://i.ibb.co/qCPPGHx/stamp2.png'; // Replace with actual stamp if needed
    await new Promise(resolve => stamp.onload = resolve);
    doc.addImage(stamp, 'PNG', 160, 140, 30, 30);

    doc.save(`${type}-Certificate-${id}.pdf`);
  }

  loadApprovedCertificates();
</script>

</body>
</html>
